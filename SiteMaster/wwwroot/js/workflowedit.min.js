function GetTaskDetails(){var n=$("#Id").val();HttpGetAsync(`/WorkFlowTemplate/GetTaskDetails/?id=${n}`,"json",function(n){var r,t,i;for(n=JSON.parse(n),r=n.length,t=0;t<n.length;t++)i=GetSearchParam(n[t].parameterValue),HttpPostAsync(`/WorkFlowTemplate/GetDetails`,"html",i,function(n){$("#LoadReportView").append(n)});$("input[type='hidden'][name='ParameterSkipList[0]']").remove();FillLevels(n)})}function FillLevels(n){var c=n.length,h=0,r,u,f,e,o,s,i,t;for($(".ParameterConditionalListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterConditionalList["+h+"]");h=h+1}),i=0,$(".ParameterNameListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterNameList["+i+"]");i=i+1}),r=0,$(".ParameterValueListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterValueList["+r+"]");$(this).removeAttr("onchange");$(this).attr("onchange","callTypeDropdown("+r+")");r=r+1}),i=0,$(".nameClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLabelNameList["+i+"]");i=i+1}),u=0,$(".ParameterLevelListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLevelList["+u+"]");$(this).val(u+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");u=u+1}),f=0,$(".ParameterOrderListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterOrderList["+f+"]");$(this).val(f+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");f=f+1}),e=0,$(".ParameterActionListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterActionList["+e+"]");e=e+1}),$(".ParameterActionListClass").attr("multiple",""),o=0,$(".ParameterSkipListClass").each(function(){$(this).removeAttr("name").attr("name","ParameterSkipList["+o+"]");o=o+1}),s=1,$(".sn").each(function(){$(this).html("Level "+s);s=s+1}),i=1,$(".delete-record").each(function(){$(this).removeAttr("data-id");$(this).attr("data-id",i);i=i+1}),i=1,$(".recordDiv").each(function(){$(this).removeAttr("data-id");$(this).attr("id","recordDiv"+i);i=i+1}),t=0;t<n.length;t++)n[t].parameterSkip==!0?($("input[name='ParameterSkipList["+t+"]']").prop("checked",!0),$("input[name='ParameterSkipList["+t+"]']").val("true")):($("input[name='ParameterSkipList["+t+"]']").prop("checked",!1),$("input[name='ParameterSkipList["+t+"]']").val("false")),$("Select[name='ParameterConditionalList["+t+"]']").val(n[t].parameterConditional),$("Select[name='ParameterValueList["+t+"]']").val(n[t].parameterValue),$("Select[name='ParameterValueList["+t+"]']").trigger("change"),$("Select[name='ParameterNameList["+t+"]']").val(n[t].parameterName),$("input[name='ParameterLevelList["+t+"]']").val(n[t].parameterLevel),$("input[name='ParameterOrderList["+t+"]']").val(n[t].parameterOrder),$("Select[name='ParameterActionList["+t+"]']").val(n[t].parameterAction)}function GetLevelDetails(){if($("#tbl_posts #add #parameterName").val()!=""&&$("#tbl_posts #add #parameterValue").val()!=""&&$("#tbl_posts #add #parameterLevel").val()!=""&&$("#tbl_posts #add #dropdownlist").val()!="0"&&$("#tbl_posts #add #ddlActionType").val()!="0"){var n=GetSearchParam();HttpPostAsync(`/WorkFlowTemplate/GetDetails`,"html",n,function(n){var r,i,t;$("#LoadReportView").append(n);r=0;$(".ParameterConditionalListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterConditionalList["+r+"]");r=r+1});t=0;$(".ParameterNameListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterNameList["+t+"]");t=t+1});t=0;$(".ParameterValueListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterValueList["+t+"]");$(this).removeAttr("onchange");$(this).attr("onchange","callTypeDropdown("+t+")");t=t+1});t=0;$(".nameClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLabelNameList["+t+"]");t=t+1});t=0;$(".ParameterLevelListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLevelList["+t+"]");$(this).val(t+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");t=t+1});i=0;$(".ParameterOrderListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterOrderList["+i+"]");$(this).val(i+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");i=i+1});t=0;$(".ParameterActionListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterActionList["+t+"]");t=t+1});t=0;$(".ParameterSkipListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterSkipList["+t+"]");t=t+1});t=1;$(".sn").each(function(){$(this).html("Level "+t);t=t+1});t=1;$(".delete-record").each(function(){$(this).removeAttr("data-id");$(this).attr("data-id",t);t=t+1});t=1;$(".recordDiv").each(function(){$(this).removeAttr("data-id");$(this).attr("id","recordDiv"+t);t=t+1})})}else alert("Please fill record before add new record ");$("input[type='hidden'][name='ParameterSkipList[0]']").remove()}function GetSearchParam(){var n=$(".myWebsiteTable").find("table").length,t=$("#ddlOperationType option:selected").val();return{size:n,opertaionId:t}}function GetListData(){var c=$("#Id").val(),l=$("#ModuleId option:selected").val(),a=$("#Name").val(),v=$("#Description").val(),y=$("#Slatime").val(),p=$("#EffectiveDate").val(),w=$("#ddlOperationType option:selected").val(),b=$("#RevertCode").val(),k=$("#ApprovedCode").val(),d=$("#ForwardCode").val(),e,r,n;e=$("#IsActiveData").is(":checked")?1:0;var f=[],o={},s={};for(r=$(".myWebsiteTable").find("table").length,n=0;n<r;n++){var i=[],g=$("select[name='ParameterConditionalList["+n+"]']").val(),u=$("select[name='ParameterValueList["+n+"]']").val();u=="Role"?i.push($("select[name='ParameterNameList["+n+"]']").val()):i=$("select[name='ParameterNameList["+n+"]']").val();var nt=$("input[name='ParameterLevelList["+n+"]']").val(),tt=$("input[name='ParameterOrderList["+n+"]']").val(),h=$("input[name='ParameterSkipList["+n+"]']").val(),t=$("Select[name='ParameterActionList["+n+"]']").val();if(u=="Role"&&(i==null||i=="")||u=="User"&&i.length==0||(n==0&&(t=$.grep(t,function(n){return n!=b})),n<r-1&&(t=$.grep(t,function(n){return n!=k})),n==r-1&&(t=$.grep(t,function(n){return n!=d})),t.length==0))return!1;h=$("input[name='ParameterSkipList["+n+"]']").is(":checked")?!0:!1;o={parameterConditional:g,parameterValue:u,parameterName:i,parameterLevel:nt,parameterOrder:tt,parameterSkip:h,parameterAction:t};f.push(o)}return $.isEmptyObject(f)||(s={Id:parseInt(c),moduleId:parseInt(l),slatime:parseInt(y),effectivedate:p,name:a,description:v,usertype:w,isActive:e,template:JSON.stringify(f)}),s}function ModuleIdMessage(){var n=$("#ModuleId option:selected").val();return n<1?"Module is Mandatory":!1}function NameMessage(){var n=$("#Name").val();return n==""?"Process Name is Mandatory":""}function DescriptionMessage(){var n=$("#Description").val();return n==""?"Proccess Description is Mandatory":""}function callTypeDropdown(n){var r=n,t=r,i=$("select[name='ParameterValueList["+r+"]']").val();HttpGetAsync(`/WorkFlowTemplate/GetUserList/?value=${i}`,"json",function(n){var r,u;for(r="",i=="Role"&&(r='<option selected="selected" disabled="disabled" value="0">--Select-- <\/option>'),u=0;u<n.length;u++)r=r+"<option value="+n[u].id+">"+n[u].name+"<\/option>";$("select[name='ParameterNameList["+t+"]']").val(null).trigger("change");i=="Role"?$("select[name='ParameterNameList["+t+"]']").removeAttr("multiple","multiple"):$("select[name='ParameterNameList["+t+"]']").attr("multiple","");$("select[name='ParameterNameList["+t+"]']").html(r);$("label[name='ParameterLabelNameList["+t+"]']").html(i+" Name");$("select[name='ParameterNameList["+t+"]']").select2({})})}function callSelect2(){$("select").select2({})}$(document).ready(function(){GetTaskDetails()});$(document).delegate("a.add-record","click",function(){GetLevelDetails()});$(document).delegate("a.delete-record","click",function(n){var u,f,r,i,t;return n.preventDefault(),u=confirm("Are you sure You want to delete"),u==!0?(f=jQuery(this).attr("data-id"),$("#recordDiv"+f).remove(),r=0,$(".ParameterConditionalListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterConditionalList["+r+"]");r=r+1}),t=0,$(".ParameterNameListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterNameList["+t+"]");t=t+1}),t=0,$(".ParameterValueListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterValueList["+t+"]");$(this).removeAttr("onchange");$(this).attr("onchange","callTypeDropdown("+t+")");t=t+1}),t=0,$(".nameClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLabelNameList["+t+"]");t=t+1}),t=0,$(".ParameterLevelListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterLevelList["+t+"]");$(this).val(t+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");t=t+1}),i=0,$(".ParameterOrderListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterOrderList["+i+"]");$(this).val(i+1);$(this).removeAttr("disabled","disabled");$(this).attr("disabled","disabled");i=i+1}),t=0,$(".ParameterActionListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterActionList["+t+"]");t=t+1}),t=0,$(".ParameterSkipListClass").each(function(){$(this).removeAttr("name");$(this).attr("name","ParameterSkipList["+t+"]");t=t+1}),t=1,$(".sn").each(function(){$(this).html("Level "+t);t=t+1}),t=1,$(".delete-record").each(function(){$(this).removeAttr("data-id");$(this).attr("data-id",t);t=t+1}),t=1,$(".recordDiv").each(function(){$(this).removeAttr("id");$(this).attr("id","recordDiv"+t);t=t+1}),!0):!1});$("#btnCreate").click(function(){var n,i,r,u,f,e,t,s,h,c;if(n=!1,i=$("#ModuleId option:selected").val(),parseInt(i)<1?(n=!1,$("#ModuleIdMessage").show()):n=!0,r=$("#Name").val(),r==""?(n=!1,$("#NameMessage").show()):n=!0,u=$("#Description").val(),u==""?(n=!1,$("#DescriptionMessage").show()):n=!0,f=$("#Slatime").val(),f==""?(n=!1,$("#SlatimeMessage").show()):(n=!0,$("#SlatimeMessage").hide()),e=$("#EffectiveDate").val(),e==""?(n=!1,$("#EffectiveDateMessage").show()):(n=!0,$("#EffectiveDateMessage").hide()),parseInt(i)<1||r==""||u==""||f==""||e=="")return n=!1,WarningMessage("Please Fill all Mandatory Fields");var l=$("#ApprovedCode").val(),a=$("#ForwardCode").val(),o=$(".myWebsiteTable").find("table").length;for(t=0;t<o;t++){if(s=!1,s=$("input[name='ParameterSkipList["+t+"]']").is(":checked")?!0:!1,h=$("Select[name='ParameterActionList["+t+"]']").val(),t<o-1&&jQuery.inArray(a,h)==-1)return InfoMessage("Submit Action is mandatroy at each level apart from last level.");if(t==o-1){if(jQuery.inArray(l,h)==-1)return InfoMessage("Approved action is missing at last level. Kindly include Approved Action at Last level.");if(s==!0)return InfoMessage("Last level cannot be skipped, Please unselect skip at last level")}}n&&(c=GetListData(),c?HttpPostAsync(`/WorkFlowTemplate/Edit`,"json",c,function(n){n!=null?n[0]=="false"?WarningMessage(n[1]):(window.location.href=n[0],SuccessMessage(n[1])):WarningMessage("Unable to update records")}):WarningMessage("Please Fill all details Level wise"))});$("#myForm").validate({rules:{ModuleId:{required:!0},Name:{required:!0},Description:{required:!0}},messages:{ModuleId:{required:ModuleIdMessage},Name:{required:NameMessage},Description:{required:DescriptionMessage}},highlight:function(n){$(n).closest(".form-group").addClass("has-error")},unhighlight:function(n){$(n).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(n,t){t.parent(".input-group").length?n.insertAfter(t.parent()):n.insertAfter(t)},submitHandler:function(){var n=GetListData();return HttpPostAsync(`/WorkFlowTemplate/Create`,"json",n,function(){window.location.href="/WorkFlowTemplate/Index"}),!0}});